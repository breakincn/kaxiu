import{e as c,p as K,s as Q,q as W,f as i,g as t,n as f,F as S,z as D,t as r,w as B,i as V,v as z,l as F,u as X,o,y as E}from"./vendor.Da2sdW28.js";import{t as Y,m as b}from"./index.DuRPLurf.js";import"./index.BYIGvkoh.js";const Z={class:"min-h-screen bg-gray-50"},ee={class:"px-4 py-4"},te={class:"bg-white rounded-xl shadow-sm p-4"},ae={class:"mt-3 flex flex-wrap gap-2"},se=["onClick"],le={key:0,class:"mt-3 text-sm text-gray-500"},ne={class:"mt-4 border-t border-gray-100 pt-4"},ie={key:0,class:"flex items-center justify-between"},oe={class:"text-gray-800 font-medium"},re={class:"flex items-center gap-2"},ue={key:1},de={key:0,class:"text-center text-gray-400 py-10"},ce={key:1},ve={key:0,class:"text-center text-gray-400 py-10"},me={key:1,class:"mt-4 space-y-3"},ye={class:"flex items-start justify-between gap-3"},pe={class:"flex items-center gap-2"},fe={class:"text-gray-800 font-medium"},xe={class:"text-gray-500 text-sm mt-1"},ge={class:"text-gray-400 text-xs"},be={class:"mt-3 flex gap-2"},he=["onClick"],_e=["onClick"],ke=["onClick"],we={class:"bg-white rounded-2xl w-full max-w-md overflow-hidden"},Ce={class:"px-5 py-4 border-b flex items-center justify-between"},je={class:"font-medium text-gray-800"},Ae={class:"px-5 py-5"},Te={class:"mb-4"},Me={class:"block text-gray-700 text-sm font-medium mb-2"},$e={key:0,class:"mb-4"},Be={class:"block text-gray-700 text-sm font-medium mb-2"},Ve={key:1,class:"text-gray-500 text-sm mb-5"},ze={class:"text-gray-800 font-medium"},Ee={class:"text-gray-800 font-medium"},Re=["disabled"],Se={class:"bg-white rounded-2xl w-full max-w-md p-6"},De={class:"flex items-center justify-between mb-6"},Fe={class:"mb-4"},Le=["disabled"],Oe={__name:"CustomerService",setup(Ne){const R=X(),M=c(!1),v=c(!1),j=c([]),x=c([]),d=c(""),m=K(()=>{var s;const a=d.value;if(!a)return null;const e=x.value.find(n=>n&&n.key===a)||null;return e&&e.key==="technician"&&((s=_.value)!=null&&s.technician_alias)?{...e,name:_.value.technician_alias}:e}),A=c(!1),p=c(!1),k=c(!1),w=c(!1),u=c({id:0,name:"",code:""}),h=c({technician_alias:""}),_=c(null),L=()=>{R.back()},N=()=>{d.value&&R.push(`/merchant/role-permissions/${d.value}`)},g=async()=>{var a,e;if(d.value){M.value=!0;try{const s=await b.getTechnicians(d.value);j.value=s.data.data||[]}catch(s){j.value=[],alert(((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.error)||"加载失败")}finally{M.value=!1}}},T=()=>{A.value=!1,p.value=!1,u.value={id:0,name:"",code:""}},U=()=>{p.value=!1,u.value={id:0,name:"",code:""},A.value=!0},q=a=>{!a||!a.id||(p.value=!0,u.value={id:a.id,name:a.name||"",code:a.code||""},A.value=!0)},I=async()=>{var a,e;try{const s=await b.getCurrentMerchant();_.value=((a=s.data)==null?void 0:a.data)||null,h.value.technician_alias=((e=_.value)==null?void 0:e.technician_alias)||"技师",k.value=!0}catch{alert("获取商户信息失败")}},O=async()=>{var a,e;if(!w.value){if(!h.value.technician_alias.trim()){alert("技师称谓不能为空");return}w.value=!0;try{await b.updateTechnicianAlias({technician_alias:h.value.technician_alias.trim()}),alert("称谓更新成功"),k.value=!1,_.value&&(_.value.technician_alias=h.value.technician_alias.trim())}catch(s){alert(((e=(a=s.response)==null?void 0:a.data)==null?void 0:e.error)||"更新失败")}finally{w.value=!1}}},P=async()=>{var a,e,s,n;if(!v.value){if(!u.value.name){alert("请输入技师姓名");return}if(!p.value&&!u.value.code){alert("请输入技师编号");return}v.value=!0;try{if(p.value)await b.updateTechnician(u.value.id,{name:u.value.name}),alert("更新成功");else{const y=await b.createTechnician({name:u.value.name,code:u.value.code,role:d.value}),C=(e=(a=y==null?void 0:y.data)==null?void 0:a.data)==null?void 0:e.default_password;alert(C?`创建成功！默认密码：${C}`:"创建成功")}T(),await g()}catch(y){alert(((n=(s=y.response)==null?void 0:s.data)==null?void 0:n.error)||(p.value?"更新失败":"创建失败"))}finally{v.value=!1}}},G=async a=>{var s,n;if(!a||!a.id||v.value)return;const e=!a.is_active;v.value=!0;try{await b.updateTechnician(a.id,{is_active:e}),await g()}catch(y){alert(((n=(s=y.response)==null?void 0:s.data)==null?void 0:n.error)||"操作失败")}finally{v.value=!1}},H=async a=>{var e,s;if(!(!a||!a.id)&&confirm("确定要删除该技师吗？")&&!v.value){v.value=!0;try{await b.deleteTechnician(a.id),await g()}catch(n){alert(((s=(e=n.response)==null?void 0:e.data)==null?void 0:s.error)||"删除失败")}finally{v.value=!1}}},J=async a=>{d.value=a,T(),a==="technician"&&await g()};return Q(async()=>{var s;try{const n=await Y.getServiceRoles();x.value=((s=n.data)==null?void 0:s.data)||[]}catch{x.value=[]}if(x.value.some(n=>n&&n.key==="technician")){d.value="technician",await g();return}const e=x.value.find(n=>n&&n.key);d.value=e?String(e.key):"",await g()}),W(d,()=>{g()}),(a,e)=>{var s,n,y,C;return o(),i("div",Z,[t("header",{class:"bg-white px-4 py-3 flex items-center gap-3 border-b sticky top-0 z-10"},[t("button",{onClick:L,class:"p-1"},[...e[5]||(e[5]=[t("svg",{class:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),e[6]||(e[6]=t("span",{class:"font-medium text-gray-800"},"设置客服",-1)),e[7]||(e[7]=t("div",{class:"flex-1"},null,-1))]),t("div",ee,[t("div",te,[e[9]||(e[9]=t("div",{class:"text-gray-800 font-medium"},"客服类型",-1)),t("div",ae,[(o(!0),i(S,null,D(x.value,l=>(o(),i("button",{key:l.key,type:"button",class:E(["px-3 py-2 rounded-lg text-sm font-medium border",d.value===l.key?"bg-primary text-white border-primary":"bg-white text-gray-700 border-gray-200"]),onClick:$=>J(l.key)},r(l.name),11,se))),128))]),x.value.length===0?(o(),i("div",le," 暂无可用客服类型 ")):f("",!0),t("div",ne,[d.value?(o(),i("div",ie,[t("div",oe,r(m.value.name)+"账号",1),t("div",re,[m.value&&m.value.allow_permission_adjust?(o(),i("button",{key:0,type:"button",class:"px-3 py-2 bg-blue-50 text-blue-600 rounded-lg text-sm font-medium",onClick:N}," 权限微调 ")):f("",!0),t("button",{type:"button",class:"px-3 py-2 bg-primary text-white rounded-lg text-sm font-medium",onClick:U}," 添加"+r(m.value.name),1),m.value.key==="technician"?(o(),i("button",{key:1,type:"button",class:"px-3 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium",onClick:I}," 编辑称谓 ")):f("",!0)])])):f("",!0)]),d.value?(o(),i("div",ue,[M.value?(o(),i("div",de,"加载中...")):(o(),i("div",ce,[j.value.length===0?(o(),i("div",ve,"暂无"+r(m.value.name),1)):(o(),i("div",me,[(o(!0),i(S,null,D(j.value,l=>(o(),i("div",{key:l.id,class:"border border-gray-100 rounded-xl p-4"},[t("div",ye,[t("div",null,[t("div",pe,[t("div",fe,r(l.name),1),t("span",{class:E(["px-2 py-0.5 rounded text-xs",l.is_active?"bg-green-50 text-green-600":"bg-gray-100 text-gray-500"])},r(l.is_active?"启用":"禁用"),3)]),t("div",xe,"编号："+r(l.code)+"　账号：技师: "+r(l.account),1)]),t("div",ge,"ID: "+r(l.id),1)]),t("div",be,[t("button",{type:"button",class:"px-3 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium",onClick:$=>q(l)}," 编辑 ",8,he),t("button",{type:"button",class:E(["px-3 py-2 rounded-lg text-sm font-medium",l.is_active?"bg-orange-50 text-orange-600":"bg-green-50 text-green-600"]),onClick:$=>G(l)},r(l.is_active?"禁用":"启用"),11,_e),e[8]||(e[8]=t("div",{class:"flex-1"},null,-1)),t("button",{type:"button",class:"px-3 py-2 bg-red-50 text-red-600 rounded-lg text-sm font-medium",onClick:$=>H(l)}," 删除 ",8,ke)])]))),128))]))]))])):f("",!0)])]),A.value?(o(),i("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center px-4 z-50",onClick:B(T,["self"])},[t("div",we,[t("div",Ce,[t("div",je,r(p.value?`编辑${(s=m.value)==null?void 0:s.name}`:`添加${(n=m.value)==null?void 0:n.name}`),1),t("button",{type:"button",class:"text-gray-400",onClick:T},[...e[10]||(e[10]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("div",Ae,[t("div",Te,[t("label",Me,r((y=m.value)==null?void 0:y.name)+"姓名",1),V(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>u.value.name=l),type:"text",placeholder:"如：老师1",class:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:border-primary"},null,512),[[z,u.value.name]])]),p.value?f("",!0):(o(),i("div",$e,[t("label",Be,r((C=m.value)==null?void 0:C.name)+"编号",1),V(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>u.value.code=l),type:"text",placeholder:"如：0001",class:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:border-primary"},null,512),[[z,u.value.code]])])),p.value?f("",!0):(o(),i("div",Ve,[e[11]||(e[11]=F(" 默认账号：",-1)),t("span",ze,"js"+r(u.value.code||"xxxx"),1),e[12]||(e[12]=t("br",null,null,-1)),e[13]||(e[13]=F(" 默认密码：",-1)),t("span",Ee,r((u.value.code||"xxxx")+"12345"),1)])),t("button",{type:"button",class:"w-full py-3 bg-primary text-white rounded-lg font-medium disabled:opacity-50",disabled:v.value,onClick:P},r(v.value?"保存中...":"保存"),9,Re)])])])):f("",!0),k.value?(o(),i("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center px-4 z-50",onClick:e[4]||(e[4]=B(l=>k.value=!1,["self"]))},[t("div",Se,[t("div",De,[e[15]||(e[15]=t("h3",{class:"text-xl font-bold text-gray-800"},"编辑技师称谓",-1)),t("button",{onClick:e[2]||(e[2]=l=>k.value=!1),class:"text-gray-400 hover:text-gray-600"},[...e[14]||(e[14]=[t("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),t("form",{onSubmit:B(O,["prevent"])},[t("div",Fe,[e[16]||(e[16]=t("label",{class:"block text-gray-700 text-sm font-medium mb-2"},"技师称谓",-1)),V(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>h.value.technician_alias=l),type:"text",placeholder:"如：小二、服务员、店员等",class:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:border-primary",maxlength:"20",required:""},null,512),[[z,h.value.technician_alias]]),e[17]||(e[17]=t("div",{class:"text-gray-500 text-xs mt-1"},'将替代"技师"显示在界面中',-1))]),t("button",{type:"submit",disabled:w.value,class:"w-full py-3 bg-primary text-white rounded-lg font-medium hover:bg-primary-dark transition-colors disabled:opacity-50"},r(w.value?"保存中...":"保存"),9,Le)],32)])])):f("",!0)])}}};export{Oe as default};
