import{e as s,D as N,m as B,f as _,g as o,n as R,t as c,w,i as n,v as r,u as $,o as C}from"./vendor.Da2sdW28.js";import{s as D,b as P,m as M,g as V,h as T,i as E}from"./index.DuRPLurf.js";import"./index.BYIGvkoh.js";const z={class:"min-h-screen bg-gray-50 flex items-center justify-center px-4"},F={class:"w-full max-w-md"},W={class:"text-center mb-8"},G={class:"text-gray-500"},H={class:"bg-white rounded-2xl p-6 shadow-lg"},J={class:"text-xl font-bold text-gray-800 mb-6"},K={class:"mb-4"},O={class:"block text-gray-700 text-sm font-medium mb-2"},Q=["placeholder"],X={class:"mb-6"},Y=["disabled"],Z={class:"mt-6 text-center space-y-2"},ee={class:"bg-white rounded-2xl w-full max-w-md max-h-[90vh] overflow-y-auto p-6"},te={class:"flex items-center justify-between mb-6"},oe={class:"mb-4"},ae={class:"mb-4"},se={class:"flex gap-2"},le=["disabled"],ne={class:"mb-4"},re={class:"mb-4"},ie={class:"mb-6"},de={class:"mb-6"},ue=["disabled"],ve={__name:"Login",setup(ce){var k;const U=$(),f=N(),i=s(!1),x=s("");i.value=typeof((k=f.params)==null?void 0:k.slug)=="string"&&f.path.startsWith("/s/"),x.value=i.value?String(f.params.slug):"";const m=s(""),p=s(""),v=s(!1),g=s(!1),b=s(!1),h=s(!1),d=s(0);let u=null;const a=s({phone:"",code:"",password:"",name:"",type:"",invite_code:""}),q=()=>{d.value=60,u=setInterval(()=>{d.value-=1,d.value<=0&&(clearInterval(u),u=null)},1e3)};B(()=>{u&&(clearInterval(u),u=null)});const A=async()=>{var l,e,t,y;if(!a.value.phone){alert("请先输入手机号");return}h.value=!0;try{const S=(e=(l=(await D.send(a.value.phone,"merchant_register")).data)==null?void 0:l.data)==null?void 0:e.debug_code;alert(S?`验证码已发送（开发模式）：${S}`:"验证码已发送"),q()}catch(I){alert(((y=(t=I.response)==null?void 0:t.data)==null?void 0:y.error)||"发送失败，请重试")}finally{h.value=!1}},j=async()=>{var l,e;v.value=!0;try{const t=i.value?await P.technicianLogin(x.value,m.value,p.value):await M.login(m.value,p.value);if(console.log("登录响应:",t.data),console.log("完整响应对象:",t),!t.data||!t.data.merchant)throw console.error("登录响应结构异常:",t.data),new Error("登录响应数据格式错误");console.log("商户信息:",t.data.merchant),t.data.technician&&t.data.technician.id?(V("staff"),T(x.value),localStorage.setItem("technicianToken",t.data.token),localStorage.setItem("technicianMerchantId",t.data.merchant.id),localStorage.setItem("technicianMerchantName",t.data.merchant.name),localStorage.setItem("technicianMerchantPhone",t.data.merchant.phone),sessionStorage.setItem("technicianId",t.data.technician.id),sessionStorage.setItem("technicianName",t.data.technician.name||""),sessionStorage.setItem("technicianCode",t.data.technician.code||""),sessionStorage.setItem("technicianAccount",t.data.technician.account||"")):(V("merchant"),T(""),localStorage.setItem("merchantToken",t.data.token),localStorage.setItem("merchantId",t.data.merchant.id),localStorage.setItem("merchantName",t.data.merchant.name),localStorage.setItem("merchantPhone",t.data.merchant.phone),sessionStorage.removeItem("technicianId"),sessionStorage.removeItem("technicianName"),sessionStorage.removeItem("technicianCode"),sessionStorage.removeItem("technicianAccount")),await E(),console.log("登录信息已保存，准备跳转..."),console.log("merchantToken:",localStorage.getItem("merchantToken")),console.log("merchantId:",localStorage.getItem("merchantId")),console.log("technicianToken:",localStorage.getItem("technicianToken")),console.log("technicianMerchantId:",localStorage.getItem("technicianMerchantId")),console.log('即将执行 router.push("/merchant")'),U.push("/merchant").then(()=>{console.log("router.push 成功")}).catch(y=>{console.error("router.push 失败:",y)})}catch(t){console.error("登录失败:",t),console.error("错误响应:",t.response),alert(((e=(l=t.response)==null?void 0:l.data)==null?void 0:e.error)||"登录失败，请重试")}finally{v.value=!1}},L=async()=>{var l,e;b.value=!0;try{console.log("正在注册，数据:",a.value);const t=await M.register(a.value);console.log("注册响应:",t.data),alert("注册成功！请登录"),g.value=!1,m.value=a.value.phone,p.value=a.value.password,a.value={phone:"",code:"",password:"",name:"",type:"",invite_code:""}}catch(t){console.error("注册失败:",t),console.error("错误响应:",t.response),alert(((e=(l=t.response)==null?void 0:l.data)==null?void 0:e.error)||"注册失败，请重试")}finally{b.value=!1}};return(l,e)=>(C(),_("div",z,[o("div",F,[o("div",W,[e[11]||(e[11]=o("div",{class:"flex items-center justify-center gap-2 mb-2"},[o("span",{class:"text-primary font-bold text-3xl"},"卡包"),o("span",{class:"text-gray-400 text-sm"},"kabao.shop")],-1)),o("p",G,c(i.value?"技师端登录":"商户登录"),1)]),o("div",H,[o("h2",J,c(i.value?"技师登录":"商户管理后台"),1),o("form",{onSubmit:w(j,["prevent"])},[o("div",K,[o("label",O,c(i.value?"技师账号":"账号/手机号"),1),n(o("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>m.value=t),type:"text",placeholder:i.value?"请输入技师账号（如js0001）":"请输入账号/手机号",class:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:border-primary",required:""},null,8,Q),[[r,m.value]])]),o("div",X,[e[12]||(e[12]=o("label",{class:"block text-gray-700 text-sm font-medium mb-2"},"密码",-1)),n(o("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>p.value=t),type:"password",placeholder:"请输入密码",class:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:border-primary",required:""},null,512),[[r,p.value]])]),o("button",{type:"submit",disabled:v.value,class:"w-full py-3 bg-primary text-white rounded-lg font-medium hover:bg-primary-dark transition-colors disabled:opacity-50"},c(v.value?"登录中...":"登录"),9,Y)],32),o("div",Z,[o("div",null,[e[13]||(e[13]=o("span",{class:"text-sm text-gray-500"},"还没有账号？",-1)),o("button",{onClick:e[2]||(e[2]=t=>g.value=!0),class:"text-sm text-primary hover:underline ml-1"}," 立即注册 ")])])])]),g.value?(C(),_("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center px-4 z-50",onClick:e[10]||(e[10]=w(t=>g.value=!1,["self"]))},[o("div",ee,[o("div",te,[e[15]||(e[15]=o("h3",{class:"text-xl font-bold text-gray-800"},"商户注册",-1)),o("button",{onClick:e[3]||(e[3]=t=>g.value=!1),class:"text-gray-400 hover:text-gray-600"},[...e[14]||(e[14]=[o("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),o("form",{onSubmit:w(L,["prevent"])},[o("div",oe,[e[16]||(e[16]=o("label",{class:"block text-gray-700 text-sm font-medium mb-2"},"手机号",-1)),n(o("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>a.value.phone=t),type:"tel",placeholder:"请输入手机号",class:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:border-primary",required:""},null,512),[[r,a.value.phone]])]),o("div",ae,[e[17]||(e[17]=o("label",{class:"block text-gray-700 text-sm font-medium mb-2"},"验证码",-1)),o("div",se,[n(o("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.code=t),type:"text",placeholder:"请输入验证码",class:"flex-1 px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:border-primary",required:""},null,512),[[r,a.value.code]]),o("button",{type:"button",disabled:h.value||d.value>0,class:"px-3 py-3 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors disabled:opacity-50 whitespace-nowrap shrink-0",onClick:A},c(d.value>0?`${d.value}s`:h.value?"发送中...":"发送验证码"),9,le)])]),o("div",ne,[e[18]||(e[18]=o("label",{class:"block text-gray-700 text-sm font-medium mb-2"},"密码",-1)),n(o("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>a.value.password=t),type:"password",placeholder:"请输入密码（至少6位）",class:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:border-primary",required:"",minlength:"6"},null,512),[[r,a.value.password]])]),o("div",re,[e[19]||(e[19]=o("label",{class:"block text-gray-700 text-sm font-medium mb-2"},"商户名称",-1)),n(o("input",{"onUpdate:modelValue":e[7]||(e[7]=t=>a.value.name=t),type:"text",placeholder:"请输入商户名称",class:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:border-primary",required:""},null,512),[[r,a.value.name]])]),o("div",ie,[e[20]||(e[20]=o("label",{class:"block text-gray-700 text-sm font-medium mb-2"},"商户类型",-1)),n(o("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>a.value.type=t),type:"text",placeholder:"如：理发、美容、健身等",class:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:border-primary"},null,512),[[r,a.value.type]])]),o("div",de,[e[21]||(e[21]=o("label",{class:"block text-gray-700 text-sm font-medium mb-2"},"邀请码",-1)),n(o("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>a.value.invite_code=t),type:"text",placeholder:"请输入邀请码",class:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:border-primary",required:""},null,512),[[r,a.value.invite_code]])]),o("button",{type:"submit",disabled:b.value,class:"w-full py-3 bg-primary text-white rounded-lg font-medium hover:bg-primary-dark transition-colors disabled:opacity-50"},c(b.value?"注册中...":"注册"),9,ue)],32)])])):R("",!0)]))}};export{ve as default};
