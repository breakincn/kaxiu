import{e as d,s as I,x as V,f as i,g as e,t as b,l as f,n as x,w as j,i as y,v as h,u as U,o as c}from"./vendor.Da2sdW28.js";import{e as m}from"./index.DuRPLurf.js";import{_ as $}from"./index.BYIGvkoh.js";const N={class:"min-h-screen bg-gray-50"},P={class:"bg-white px-4 py-3 flex items-center gap-3 border-b sticky top-0 z-10"},S={class:"font-medium text-gray-800"},D={key:0,class:"flex items-center justify-center py-12"},H={key:1,class:"px-4 py-6"},T={class:"bg-white rounded-xl shadow-sm p-6"},E={class:"text-center"},R={class:"text-2xl font-semibold text-gray-800 mb-6 no-underline",style:{"text-decoration":"none"}},q={key:2,class:"px-4 py-6"},A={class:"bg-white rounded-xl shadow-sm p-6"},F={class:"flex gap-2"},G=["disabled"],J={type:"submit",class:"w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 font-medium mt-6"},K={key:0,class:"mt-4 px-4 py-3 bg-blue-50 rounded-lg"},L={__name:"BindPhone",setup(O){const w=U(),g=d(!0),o=d(""),u=d(!1),l=d(""),n=d(""),a=d(0);let v=null;const k=async()=>{g.value=!0;try{const t=(await m.get("/me")).data.data;t.phone&&(o.value=t.phone)}catch(s){console.error("获取用户信息失败:",s)}finally{g.value=!1}},_=()=>{w.back()},C=()=>{u.value=!0,l.value="",n.value=""},B=()=>{u.value=!1,l.value="",n.value="",a.value>0&&(clearInterval(v),a.value=0)},M=async()=>{var s,t,r;if(!l.value){alert("请输入手机号");return}if(!/^1[3-9]\d{9}$/.test(l.value)){alert("请输入正确的手机号");return}try{const p=await m.post("/sms/send",{phone:l.value,purpose:"user_bind_phone"});(s=p.data.data)!=null&&s.debug_code?alert(`验证码已发送（开发环境）：${p.data.data.debug_code}`):alert("验证码已发送，请查收短信"),a.value=60,v=setInterval(()=>{a.value--,a.value<=0&&clearInterval(v)},1e3)}catch(p){alert(((r=(t=p.response)==null?void 0:t.data)==null?void 0:r.error)||"发送验证码失败")}},z=async()=>{var s,t;if(!l.value){alert("请输入手机号");return}if(!/^1[3-9]\d{9}$/.test(l.value)){alert("请输入正确的手机号");return}if(!n.value){alert("请输入验证码");return}try{await m.post("/user/bind-phone",{phone:l.value,code:n.value}),alert(o.value?"更换成功！":"绑定成功！"),o.value=l.value,u.value=!1,l.value="",n.value=""}catch(r){alert(((t=(s=r.response)==null?void 0:s.data)==null?void 0:t.error)||(o.value?"更换失败":"绑定失败"))}};return I(()=>{k()}),V(()=>{v&&clearInterval(v)}),(s,t)=>(c(),i("div",N,[e("header",P,[e("button",{onClick:_,class:"p-1"},[...t[2]||(t[2]=[e("svg",{class:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),e("span",S,b(o.value?"更换手机号":"绑定手机号"),1)]),g.value?(c(),i("div",D,[...t[3]||(t[3]=[e("div",{class:"text-gray-400"},"加载中...",-1)])])):o.value&&!u.value?(c(),i("div",H,[e("div",T,[e("div",E,[t[4]||(t[4]=e("div",{class:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"},[e("svg",{class:"w-8 h-8 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),t[5]||(t[5]=e("h3",{class:"text-lg font-medium text-gray-800 mb-2"},"已绑定手机号",-1)),e("p",R,b(o.value),1),e("button",{onClick:C,class:"w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 font-medium"}," 更换手机号 ")])]),t[6]||(t[6]=e("div",{class:"mt-4 px-4 py-3 bg-yellow-50 rounded-lg"},[e("p",{class:"text-sm text-yellow-600"},[e("svg",{class:"w-4 h-4 inline-block mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),f(" 更换手机号需要验证新手机号，请确保新手机号可以正常接收验证码 ")])],-1))])):(c(),i("div",q,[e("div",A,[e("form",{onSubmit:j(z,["prevent"]),class:"space-y-4"},[e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"手机号",-1)),y(e("input",{"onUpdate:modelValue":t[0]||(t[0]=r=>l.value=r),type:"tel",placeholder:"请输入手机号",maxlength:"11",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[h,l.value]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"验证码",-1)),e("div",F,[y(e("input",{"onUpdate:modelValue":t[1]||(t[1]=r=>n.value=r),type:"text",placeholder:"请输入验证码",maxlength:"6",class:"flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[h,n.value]]),e("button",{type:"button",onClick:M,disabled:a.value>0,class:"px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed whitespace-nowrap"},b(a.value>0?`${a.value}秒后重试`:"发送验证码"),9,G)])]),e("button",J,b(o.value?"确认更换":"确认绑定"),1),u.value?(c(),i("button",{key:0,type:"button",onClick:B,class:"w-full bg-gray-200 text-gray-700 py-3 rounded-lg hover:bg-gray-300 font-medium mt-3"}," 取消 ")):x("",!0)],32)]),u.value?x("",!0):(c(),i("div",K,[...t[9]||(t[9]=[e("p",{class:"text-sm text-blue-600"},[e("svg",{class:"w-4 h-4 inline-block mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})]),f(" 绑定手机号后，可以使用手机号登录账户 ")],-1)])]))]))]))}},Y=$(L,[["__scopeId","data-v-cf3b0f6b"]]);export{Y as default};
