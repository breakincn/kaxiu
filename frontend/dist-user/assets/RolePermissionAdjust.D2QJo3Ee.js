import{e as u,D as R,s as C,f as l,g as e,t as i,F as j,z as D,u as M,o as r,i as P,L as V}from"./vendor.Da2sdW28.js";import{m as g}from"./index.DuRPLurf.js";import"./index.BYIGvkoh.js";const z={class:"min-h-screen bg-gray-50"},A={class:"bg-white px-4 py-3 flex items-center gap-3 border-b sticky top-0 z-10"},F=["disabled"],K={class:"px-4 py-4"},L={class:"bg-white rounded-xl shadow-sm p-4"},S={class:"text-gray-800 font-medium"},U={class:"text-gray-500 text-sm mt-1"},E={class:"bg-white rounded-xl shadow-sm p-4 mt-4"},N={key:0,class:"text-center text-gray-400 py-10"},q={key:1},G={key:0,class:"text-center text-gray-400 py-10"},H={key:1,class:"space-y-2"},I={class:"pr-3"},J={class:"text-gray-800 text-sm font-medium"},O={class:"text-gray-500 text-xs mt-0.5"},Q={class:"flex items-center gap-2 text-sm text-gray-700 shrink-0"},T=["onUpdate:modelValue"],$={__name:"RolePermissionAdjust",setup(W){const h=M(),f=R(),x=u(String(f.params.roleKey||"")),y=u(!1),d=u(!1),_=u(null),m=u([]),w=()=>{h.back()},k=async()=>{var n,s,t,a,o,p;y.value=!0;try{const v=await g.getRolePermissions(x.value);_.value=((s=(n=v.data)==null?void 0:n.data)==null?void 0:s.role)||null;const B=((a=(t=v.data)==null?void 0:t.data)==null?void 0:a.items)||[];m.value=B.map(c=>({permission:c.permission,default_allowed:!!c.default_allowed,override_allowed:typeof c.override_allowed=="boolean"?c.override_allowed:c.effective_allowed}))}catch(v){alert(((p=(o=v.response)==null?void 0:o.data)==null?void 0:p.error)||"加载失败")}finally{y.value=!1}},b=async()=>{var n,s;if(!d.value){d.value=!0;try{const t={items:m.value.map(a=>({permission_key:a.permission.key,allowed:!!a.override_allowed}))};await g.setRolePermissions(x.value,t),alert("保存成功")}catch(t){alert(((s=(n=t.response)==null?void 0:n.data)==null?void 0:s.error)||"保存失败")}finally{d.value=!1}}};return C(k),(n,s)=>{var t,a;return r(),l("div",z,[e("header",A,[e("button",{onClick:w,class:"p-1"},[...s[0]||(s[0]=[e("svg",{class:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),s[1]||(s[1]=e("span",{class:"font-medium text-gray-800"},"权限微调",-1)),s[2]||(s[2]=e("div",{class:"flex-1"},null,-1)),e("button",{type:"button",class:"px-3 py-2 bg-primary text-white rounded-lg text-sm font-medium disabled:opacity-50",disabled:d.value,onClick:b},i(d.value?"保存中...":"保存"),9,F)]),e("div",K,[e("div",L,[e("div",S,i(((t=_.value)==null?void 0:t.name)||"-"),1),e("div",U,"key："+i(((a=_.value)==null?void 0:a.key)||"-"),1)]),e("div",E,[y.value?(r(),l("div",N,"加载中...")):(r(),l("div",q,[m.value.length===0?(r(),l("div",G,"暂无权限项")):(r(),l("div",H,[(r(!0),l(j,null,D(m.value,o=>(r(),l("div",{key:o.permission.id,class:"flex items-center justify-between border border-gray-100 rounded-xl px-4 py-3"},[e("div",I,[e("div",J,i(o.permission.name),1),e("div",O,i(o.permission.key),1)]),e("label",Q,[P(e("input",{type:"checkbox","onUpdate:modelValue":p=>o.override_allowed=p},null,8,T),[[V,o.override_allowed]]),e("span",null,i(o.override_allowed?"允许":"禁止"),1)])]))),128))]))]))]),s[3]||(s[3]=e("div",{class:"text-gray-400 text-xs mt-3 px-1"}," 默认权限由平台配置；此处仅保存“覆盖值”。 ",-1))])])}}};export{$ as default};
