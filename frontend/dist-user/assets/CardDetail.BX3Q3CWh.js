import{e as c,p as F,s as he,x as xe,f as a,g as s,n as m,t as i,A as C,y as p,l as jt,F as W,z as G,w as b,C as ye,D as _e,u as we,B as be,o}from"./vendor.Da2sdW28.js";import{c as Ut,d as N,n as ke,u as Te}from"./index.DuRPLurf.js";import{a as V,f as Bt}from"./dateFormat.BMJ2_UIx.js";import{Q as It}from"./browser.DZr5NsCX.js";import"./index.BYIGvkoh.js";const Ce={class:"min-h-screen bg-gray-50 pb-6"},Me={class:"bg-white px-4 py-3 flex items-center gap-3 border-b sticky top-0 z-10"},De={class:"font-medium text-gray-800"},Se={class:"px-4 mt-4"},Ae={class:"bg-white rounded-2xl p-5 shadow-sm border border-gray-200"},$e={class:"space-y-3.5"},je={class:"flex justify-between"},Ue={class:"text-gray-800"},Be={class:"flex justify-between"},Ie={class:"text-gray-800"},He={class:"flex justify-between"},Le={class:"text-gray-800"},Fe={class:"flex justify-between"},Ne={class:"text-gray-800"},Ve={class:"flex justify-between"},Ee={class:"text-gray-800"},ze={class:"flex justify-between"},Qe={class:"text-gray-800"},Re={class:"flex justify-between"},Pe={class:"text-gray-800"},Ye={key:0,class:"flex justify-between"},qe={class:"text-gray-800 text-right max-w-[70%]"},Oe={key:0,class:"px-4 mt-4"},Xe={class:"bg-white rounded-2xl p-5 shadow-sm border border-gray-200"},We={class:"flex items-center justify-between mb-3"},Ge={class:"flex items-center gap-2"},Je={key:0,class:"bg-red-500 text-white text-sm font-medium px-3 py-1 rounded"},Ke=["innerHTML"],Ze={key:1,class:"px-4 mt-4"},ts={class:"bg-white rounded-2xl p-5 shadow-sm border border-gray-200"},es={key:0,class:"space-y-3"},ss={class:"flex justify-between items-center"},ns={class:"flex justify-between items-center"},as={class:"text-right"},os={key:0,class:"text-sm text-gray-600 mb-1"},rs={key:2,class:"text-sm text-gray-400"},is={class:"grid grid-cols-2 gap-4 pt-3 mt-3 border-t border-gray-200"},ls={class:"text-2xl font-bold text-gray-800"},cs={class:"text-2xl font-bold text-gray-800"},us=["disabled"],ds={key:1,class:"text-center"},vs=["disabled"],ms={key:2,class:"px-4 mt-4"},ps={class:"bg-white rounded-xl p-4 shadow-sm"},gs=["disabled"],fs={key:0,class:"mt-4 flex justify-center"},hs=["src"],xs={key:1,class:"text-center text-gray-400 text-sm mt-2"},ys={class:"px-4 mt-4"},_s={class:"bg-white rounded-2xl p-5 shadow-sm border border-gray-200"},ws={class:"flex items-center justify-between mb-4"},bs={class:"text-gray-600 text-sm"},ks={key:0,class:"space-y-2"},Ts=["onTouchstart"],Cs={class:"text-gray-800"},Ms={class:"flex items-center gap-2"},Ds={class:"text-gray-500 text-sm"},Ss={class:"text-gray-400 text-sm"},As={key:0,class:"text-gray-400 text-sm mt-0.5"},$s={key:1,class:"text-center text-gray-400 py-4"},js={class:"bg-white rounded-2xl w-11/12 max-w-lg overflow-hidden"},Us={class:"px-5 py-5"},Bs={class:"text-center"},Is={class:"text-gray-800 font-medium"},Hs={class:"text-gray-500 text-sm mt-1"},Ls={key:0,class:"mt-4 flex justify-center"},Fs=["src"],Ns={key:2,class:"mt-1 text-center text-xs text-red-500"},Vs={class:"bg-white rounded-2xl p-5 shadow-sm border border-gray-200"},Es={class:"space-y-4"},zs={class:"flex items-center gap-2 mb-1"},Qs={class:"font-medium text-gray-800"},Rs={key:0,class:"px-2 py-0.5 bg-red-500 text-white text-xs rounded"},Ps={class:"text-gray-500 text-sm mt-1"},Ys={class:"text-gray-400 text-xs mt-1"},qs={class:"bg-white rounded-2xl w-11/12 max-w-lg max-h-[80vh] overflow-hidden"},Os={class:"px-5 py-3 border-b"},Xs={class:"flex gap-2"},Ws=["disabled"],Gs={key:0,class:"mt-3"},Js={key:0,class:"text-gray-400 text-sm"},Ks={key:1,class:"text-gray-400 text-sm"},Zs={key:2,class:"grid grid-cols-2 gap-2"},tn=["onClick"],en={class:"px-5 py-3 border-b"},sn={class:"flex gap-2"},nn={class:"px-5 py-4 overflow-y-auto",style:{"max-height":"400px"}},an={key:0,class:"text-center py-8 text-gray-400"},on={key:1,class:"text-center py-8 text-gray-400"},rn={key:2,class:"grid grid-cols-2 gap-3"},ln=["onClick","disabled"],cn={key:0,class:"text-xs mt-1"},un={class:"px-5 py-4 border-t"},dn=["disabled"],xn={__name:"CardDetail",setup(vn){const dt=we(),M=_e(),r=c({}),J=c([]),E=c([]),d=c(null),z=c(0),Q=c(0),g=c(0);let R=null;const K=c(null),A=c(""),P=c(""),$=c(!1),Y=c("");let _=null;const D=c(!1),j=c(!1),Z=c(!1),x=c(null),U=c("");let B=null,vt=0,mt=0,tt=!1;const Ht=e=>{const t=String((e==null?void 0:e.status)||"").trim();return t==="in_progress"?"进行中":t==="success"?"完成":t==="failed"?"失败":t||""},Lt=e=>{const t=String((e==null?void 0:e.status)||"").trim();return t==="in_progress"?"text-blue-500":t==="success"?"":"text-red-500"},Ft=e=>{const t=Number(e||0);return t?new Date(t*1e3).toLocaleString():""},pt=e=>{const t=e==null?void 0:e.used_at;if(!t)return 0;const n=new Date(t).getTime();return Number.isFinite(n)?n:0},et=e=>{const t=pt(e);return t?Math.floor(t/1e3)+720*60:0},Nt=e=>{const t=et(e);return t?Ft(t):""},Vt=e=>{var u,v;const t=pt(e);if(!t)return 0;let n=Number(((v=(u=r.value)==null?void 0:u.merchant)==null?void 0:v.avg_service_minutes)||0);return(!n||n<=0)&&(n=15),t+n*60*1e3},q=c(Date.now());let I=null;const Et=()=>{I||(I=setInterval(()=>{q.value=Date.now()},1e3))},gt=()=>{I&&(clearInterval(I),I=null)},ft=e=>{const t=Vt(e);if(!t)return"text-gray-400";const n=q.value;return n>=t+3600*1e3?"text-red-500":n>=t?"text-green-500":"text-gray-400"},ht=e=>{const t=et(e)*1e3;if(!t)return"";const n=q.value,u=t-n;if(u<=0)return"";const v=Math.floor(u/1e3),w=Math.floor(v/3600),y=Math.floor(v%3600/60),S=v%60;return w>0?`${w}小时${y}分${S}秒`:y>0?`${y}分${S}秒`:`${S}秒`},zt=e=>{if(!e||String(e.status||"").trim()!=="in_progress"||!String(e.verify_code||"").trim())return!1;const u=et(e);return u?Math.floor(Date.now()/1e3)<=u:!1},Qt=async e=>{if(zt(e)){x.value=e,Z.value=!0,U.value="",q.value=Date.now(),Et();try{U.value=await It.toDataURL(String(e.verify_code).trim(),{margin:1,scale:8,errorCorrectionLevel:"M"})}catch{}}},xt=()=>{Z.value=!1,x.value=null,U.value="",gt()},st=()=>{B&&(clearTimeout(B),B=null)},Rt=(e,t)=>{var u;st(),tt=!1;const n=(u=e==null?void 0:e.touches)==null?void 0:u[0];vt=(n==null?void 0:n.clientX)||0,mt=(n==null?void 0:n.clientY)||0,B=setTimeout(()=>{B=null,!tt&&Qt(t)},550)},Pt=e=>{var v;const t=(v=e==null?void 0:e.touches)==null?void 0:v[0],n=(t==null?void 0:t.clientX)||0,u=(t==null?void 0:t.clientY)||0;(Math.abs(n-vt)>10||Math.abs(u-mt)>10)&&(tt=!0,st())},yt=()=>{st()},_t=c(null),nt=c(!1),at=c(!1),f=c("time"),k=c(""),h=c(""),H=c([]),ot=c(!1),L=c([]),rt=c(!1),T=c(null),Yt=()=>{dt.push("/user/cards")},qt=async()=>{try{const e=await Ut.getCard(M.params.id);r.value=e.data.data,r.value.merchant_id&&Xt(r.value.merchant_id),Ot(),wt()}catch(e){console.error("获取卡片详情失败:",e)}},Ot=async()=>{try{const e=await Te.getCardUsages(M.params.id);J.value=e.data.data||[]}catch(e){console.error("获取使用记录失败:",e)}},Xt=async e=>{try{const t=await ke.getMerchantNotices(e,5);E.value=t.data.data||[],M.query.scrollToNotice==="1"&&E.value.length>0&&(nt.value=!0,await ge())}catch(t){console.error("获取通知失败:",t)}},wt=async()=>{var e;try{console.log("正在获取预约信息，卡片ID:",M.params.id);const t=await N.getCardAppointment(M.params.id);console.log("预约信息响应:",t.data);const n=t.data.data;if(K.value=(n==null?void 0:n.cooldown_until)||null,n!=null&&n.appointment){d.value=n.appointment,z.value=n.queue_before||0,Q.value=n.estimated_minutes||0,console.log("预约信息已设置:",d.value),Dt();return}console.log("未找到预约信息"),d.value=null,z.value=0,Q.value=0,O()}catch(t){console.error("获取预约信息失败:",t),console.error("错误详情:",(e=t.response)==null?void 0:e.data)}},bt=()=>{if(!K.value)return 0;const e=new Date(K.value).getTime(),t=Date.now();return Math.max(0,Math.floor((e-t)/1e3))},it=F(()=>bt()>0),Wt=F(()=>{const e=bt();return e<=0?"我要预约":`冷却中（约${Math.ceil(e/60)}分钟后可预约）`}),lt=F(()=>{if(!d.value||!d.value.appointment_time||d.value.status!=="pending"&&d.value.status!=="confirmed")return!1;const e=new Date(d.value.appointment_time).getTime();return Date.now()-e>=1800*1e3}),Gt=F(()=>!d.value||lt.value?!0:j.value||d.value.status==="finished"||d.value.status==="canceled"),Jt=F(()=>lt.value?"预约失败":j.value?"取消中...":"取消预约"),Kt=async()=>{var e,t;if(!($.value||r.value.remain_times<=0)){$.value=!0;try{const n=await Ut.generateVerifyCode(M.params.id);A.value=n.data.data.code;const u=new Date(n.data.data.expire_at*1e3);P.value=u.toLocaleTimeString(),Y.value=await It.toDataURL(A.value,{margin:1,scale:8,errorCorrectionLevel:"M"}),_&&(clearTimeout(_),_=null);const v=Math.max(0,u.getTime()-Date.now());_=setTimeout(()=>{A.value="",P.value="",Y.value="",_=null},v)}catch(n){alert(((t=(e=n.response)==null?void 0:e.data)==null?void 0:t.error)||"生成核销码失败")}finally{$.value=!1}}},Zt=async()=>{if(!r.value||!r.value.merchant_id){alert("卡片信息加载中，请稍后再试");return}at.value=!0,f.value="time",T.value=null,k.value=ut(),h.value="",await te(r.value.merchant_id),await Ct(k.value)},ct=()=>{at.value=!1,f.value="time",T.value=null,k.value="",h.value="",H.value=[]},te=async e=>{rt.value=!0;try{const t=await N.getMerchantTechnicians(e);L.value=t.data.data||[]}catch{L.value=[]}finally{rt.value=!1}},ut=()=>new Date().toISOString().slice(0,10),kt=()=>{const e=new Date;return e.setDate(e.getDate()+1),e.toISOString().slice(0,10)},Tt=async e=>{k.value=e==="today"?ut():kt(),h.value="",await Ct(k.value)},Ct=async e=>{var t,n,u;if(!r.value.merchant_id){console.error("商户ID不存在");return}ot.value=!0;try{console.log("正在获取时间段，商户ID:",r.value.merchant_id,"日期:",e);const v=await N.getAvailableTimeSlots(r.value.merchant_id,e);if(console.log("获取时间段响应:",v.data),H.value=v.data.data.time_slots||[],f.value==="technician"&&!h.value){const w=(H.value||[]).find(y=>y&&y.available);w&&(h.value=w.time)}}catch(v){console.error("获取可用时间段失败:",v),console.error("错误详情:",(t=v.response)==null?void 0:t.data),alert(`获取可用时间段失败: ${((u=(n=v.response)==null?void 0:n.data)==null?void 0:u.error)||v.message}`)}finally{ot.value=!1}},ee=e=>{e.available&&(h.value=e.time)},se=e=>{if(!e)return"";const t=new Date(e),n=t.getHours().toString().padStart(2,"0"),u=t.getMinutes().toString().padStart(2,"0");return`${n}:${u}`},ne=async()=>{var e,t;if(!(!h.value||D.value)){if(f.value==="technician"&&!T.value){alert("请选择技师");return}D.value=!0;try{const n=localStorage.getItem("userId");if(!n){alert("请先登录"),dt.push("/login");return}await N.createAppointment({merchant_id:r.value.merchant_id,user_id:parseInt(n),technician_id:f.value==="technician"?T.value:null,appointment_time:h.value}),ct(),await wt(),alert("预约成功！")}catch(n){alert(((t=(e=n.response)==null?void 0:e.data)==null?void 0:t.error)||"预约失败")}finally{D.value=!1}}},ae=async()=>{var e,t;if(!j.value&&!lt.value&&confirm("确定要取消预约吗？")){j.value=!0;try{await N.cancelAppointment(d.value.id),d.value=null,z.value=0,Q.value=0,O(),alert("已取消预约")}catch(n){alert(((t=(e=n.response)==null?void 0:e.data)==null?void 0:t.error)||"取消预约失败")}finally{j.value=!1}}},oe=e=>({pending:"text-primary",confirmed:"text-primary",finished:"text-gray-600",canceled:"text-gray-400"})[e]||"text-gray-500",re=e=>({pending:"待确认",confirmed:"排队中",finished:"已完成",canceled:"已取消"})[e]||e,ie=e=>{if(!e)return"";const t=["周日","周一","周二","周三","周四","周五","周六"],n=new Date(e);return t[n.getDay()]},le=()=>{if(!d.value||!d.value.appointment_time)return 0;const e=new Date(d.value.appointment_time).getTime(),t=Date.now();return Math.floor((e-t)/1e3)},Mt=()=>{g.value=le()},Dt=()=>{O(),Mt(),R=setInterval(Mt,1e3)},O=()=>{R&&(clearInterval(R),R=null)},ce=()=>g.value<-60,ue=()=>g.value<-60?"text-gray-400":g.value>0&&g.value<=300?"text-red-500":"text-gray-800",de=()=>g.value>0&&g.value<=300?"text-red-500":"text-gray-600",ve=()=>{if(g.value<=0&&g.value>-60)return"预约时间已到";const e=Math.abs(g.value),t=Math.floor(e/3600),n=Math.floor(e%3600/60),u=e%60;return t>0?`${t}小时${n}分${u}秒`:n>0?`${n}分${u}秒`:`${u}秒`},me=()=>d.value?d.value.status==="confirmed"?g.value<=300&&g.value>-60:!1:!0,St=()=>{if(!r.value||!r.value.merchant)return"";const e=r.value.merchant,t=[];return e.province&&t.push(e.province),e.city&&t.push(e.city),e.district&&t.push(e.district),e.address&&t.push(e.address),t.join("")},At=()=>{if(!r.value||!r.value.merchant)return"";const e=r.value.merchant,t=[];return e.all_day_start&&e.all_day_end?`全天营业: ${e.all_day_start} - ${e.all_day_end}`:(e.morning_start&&e.morning_end&&t.push(`上午: ${e.morning_start} - ${e.morning_end}`),e.afternoon_start&&e.afternoon_end&&t.push(`下午: ${e.afternoon_start} - ${e.afternoon_end}`),e.evening_start&&e.evening_end&&t.push(`晚上: ${e.evening_start} - ${e.evening_end}`),t.length>0?t.join("<br>"):"")},$t=()=>!r.value||!r.value.merchant?!0:r.value.merchant.is_open!==!1,pe=()=>{const e=window.innerHeight||800;return`${Math.max(e-700,300)}px`},ge=async()=>{await be(),await new Promise(t=>setTimeout(t,100));const e=_t.value;if(e)try{const n=e.getBoundingClientRect().top+window.scrollY-4;window.scrollTo({top:n,behavior:"smooth"})}catch{try{e.scrollIntoView({behavior:"smooth",block:"start"})}catch{}}};return he(async()=>{await qt(),d.value&&Dt()}),xe(()=>{O(),_&&(clearTimeout(_),_=null),gt(),nt.value=!1}),(e,t)=>{var n,u,v,w,y,S;return o(),a("div",Ce,[s("header",Me,[s("button",{onClick:Yt,class:"p-1"},[...t[10]||(t[10]=[s("svg",{class:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),s("span",De,i(((n=r.value.merchant)==null?void 0:n.name)||"卡片详情"),1)]),s("div",Se,[s("div",Ae,[t[19]||(t[19]=s("div",{class:"flex items-center gap-2 mb-4"},[s("svg",{class:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})]),s("span",{class:"font-medium text-gray-800"},"卡片详情")],-1)),s("div",$e,[s("div",je,[t[11]||(t[11]=s("span",{class:"text-gray-500"},"商户名称",-1)),s("span",Ue,i((u=r.value.merchant)==null?void 0:u.name),1)]),s("div",Be,[t[12]||(t[12]=s("span",{class:"text-gray-500"},"卡类型",-1)),s("span",Ie,i(r.value.card_type),1)]),s("div",He,[t[13]||(t[13]=s("span",{class:"text-gray-500"},"开卡/充值",-1)),s("span",Le,i(C(V)(r.value.recharge_at))+" / ¥"+i(r.value.recharge_amount),1)]),s("div",Fe,[t[14]||(t[14]=s("span",{class:"text-gray-500"},"总次数",-1)),s("span",Ne,i(r.value.total_times)+" 次",1)]),s("div",Ve,[t[15]||(t[15]=s("span",{class:"text-gray-500"},"已使用",-1)),s("span",Ee,i(r.value.used_times)+" 次",1)]),s("div",ze,[t[16]||(t[16]=s("span",{class:"text-gray-500"},"上次使用",-1)),s("span",Qe,i(r.value.last_used_at?C(V)(r.value.last_used_at):"未使用"),1)]),s("div",Re,[t[17]||(t[17]=s("span",{class:"text-gray-500"},"有效期",-1)),s("span",Pe,i(C(Bt)(r.value.start_date))+" 至 "+i(C(Bt)(r.value.end_date)),1)]),St()?(o(),a("div",Ye,[t[18]||(t[18]=s("span",{class:"text-gray-500"},"地址",-1)),s("span",qe,i(St()),1)])):m("",!0)])])]),At()?(o(),a("div",Oe,[s("div",Xe,[s("div",We,[s("div",Ge,[(o(),a("svg",{class:p([$t()?"text-green-500":"text-red-500","w-5 h-5"]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[20]||(t[20]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])],2)),t[21]||(t[21]=s("span",{class:"font-medium"},"营业时间",-1))]),$t()?m("",!0):(o(),a("span",Je,"打烊"))]),s("div",{class:"text-sm leading-relaxed text-gray-500",innerHTML:At()},null,8,Ke)])])):m("",!0),(v=r.value.merchant)!=null&&v.support_appointment&&!it.value?(o(),a("div",Ze,[s("div",ts,[t[28]||(t[28]=s("div",{class:"flex items-center gap-2 mb-3"},[s("svg",{class:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})]),s("span",{class:"font-medium text-gray-800"},"预约排队")],-1)),d.value?(o(),a("div",es,[s("div",ss,[t[22]||(t[22]=s("span",{class:"text-gray-500"},"我的预约",-1)),s("span",{class:p(oe(d.value.status))},i(re(d.value.status)),3)]),s("div",ns,[s("div",{class:p([ue(),"font-medium text-lg"])},i(C(V)(d.value.appointment_time)),3),s("div",as,[d.value.status==="confirmed"?(o(),a("div",os,"排队中")):m("",!0),ce()?(o(),a("div",rs," 预约已过 ")):(o(),a("div",{key:1,class:p([de(),"text-sm font-medium"])},i(ve()),3))])]),s("div",is,[s("div",null,[t[24]||(t[24]=s("div",{class:"text-gray-400 text-xs"},"前面排队",-1)),s("div",ls,[jt(i(z.value),1),t[23]||(t[23]=s("span",{class:"text-sm font-normal"},"人",-1))])]),s("div",null,[t[26]||(t[26]=s("div",{class:"text-gray-400 text-xs"},"预计等待",-1)),s("div",cs,[jt(i(Q.value),1),t[25]||(t[25]=s("span",{class:"text-sm font-normal"},"分钟",-1))])])]),t[27]||(t[27]=s("p",{class:"text-xs text-gray-400"},"* 排队进度由商户服务确认后即时更新",-1)),s("button",{onClick:ae,disabled:Gt.value,class:"w-full py-2.5 border-2 border-red-400 text-red-500 font-medium rounded-lg hover:bg-red-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors mt-3"},i(Jt.value),9,us)])):(o(),a("div",ds,[s("button",{onClick:Zt,disabled:D.value||it.value,class:"w-full py-3 border-2 border-primary text-primary font-medium rounded-lg hover:bg-primary-light disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},i(it.value?Wt.value:"我要预约"),9,vs)]))])])):m("",!0),me()?(o(),a("div",ms,[s("div",ps,[t[29]||(t[29]=s("div",{class:"text-center text-gray-600 mb-3"},"到店出示核销码",-1)),s("button",{onClick:Kt,disabled:$.value||r.value.remain_times<=0,class:"w-full py-3 border-2 border-primary text-primary font-medium rounded-lg hover:bg-primary-light disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},i($.value?"生成中...":A.value?A.value:"生成核销码"),9,gs),Y.value?(o(),a("div",fs,[s("img",{src:Y.value,alt:"核销二维码",class:"w-48 h-48"},null,8,hs)])):m("",!0),P.value?(o(),a("p",xs," 有效期至 "+i(P.value),1)):m("",!0)])])):m("",!0),s("div",ys,[s("div",_s,[s("div",ws,[t[30]||(t[30]=s("div",{class:"flex items-center gap-2"},[s("svg",{class:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})]),s("span",{class:"font-medium text-gray-800"},"使用记录")],-1)),s("span",bs," 总数"+i(r.value.total_times)+"次/剩余"+i(r.value.remain_times)+"次 ",1)]),J.value.length>0?(o(),a("div",ks,[(o(!0),a(W,null,G(J.value,l=>{var X;return o(),a("div",{key:l.id,class:"flex justify-between items-center p-3 bg-white rounded-lg shadow-sm",onTouchstart:fe=>Rt(fe,l),onTouchmove:Pt,onTouchend:yt,onTouchcancel:yt,onContextmenu:t[0]||(t[0]=b(()=>{},["prevent"])),style:{"-webkit-touch-callout":"none"}},[s("div",null,[s("div",Cs,"核销次数: "+i(l.used_times),1),s("div",Ms,[s("span",Ds,i(ie(l.used_at)),1),s("span",Ss,i(C(V)(l.used_at)),1)]),(X=l.technician)!=null&&X.code?(o(),a("div",As," 服务人员："+i(l.technician.code),1)):m("",!0)]),s("span",{class:p([Lt(l),"text-sm font-medium"])},i(Ht(l)),3)],40,Ts)}),128))])):(o(),a("div",$s," 暂无使用记录 "))])]),Z.value?(o(),a("div",{key:3,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 select-none",onClick:b(xt,["self"]),onContextmenu:t[5]||(t[5]=b(()=>{},["prevent"]))},[s("div",js,[s("div",{class:"bg-primary text-white px-5 py-4 flex items-center justify-between"},[t[32]||(t[32]=s("h3",{class:"font-medium text-lg"},"结单二维码",-1)),s("button",{onClick:xt,class:"text-white"},[...t[31]||(t[31]=[s("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),s("div",Us,[s("div",Bs,[s("div",Is,i(((y=(w=r.value)==null?void 0:w.merchant)==null?void 0:y.name)||"商户"),1),s("div",Hs,i(((S=r.value)==null?void 0:S.card_type)||""),1)]),U.value?(o(),a("div",Ls,[s("div",{class:"select-none",style:{"-webkit-touch-callout":"none","-webkit-user-select":"none","user-select":"none","pointer-events":"none","touch-action":"none"},onTouchstart:t[1]||(t[1]=b(()=>{},["prevent"])),onTouchmove:t[2]||(t[2]=b(()=>{},["prevent"])),onTouchend:t[3]||(t[3]=b(()=>{},["prevent"])),onContextmenu:t[4]||(t[4]=b(()=>{},["prevent"]))},[s("img",{src:U.value,alt:"结单二维码",class:"w-56 h-56",style:{"-webkit-touch-callout":"none"}},null,8,Fs)],32)])):m("",!0),x.value?(o(),a("div",{key:1,class:p(["mt-4 text-center text-xs",ft(x.value)])}," 有效期至 "+i(Nt(x.value)),3)):m("",!0),x.value&&ft(x.value)==="text-red-500"&&ht(x.value)?(o(),a("div",Ns," 离失效还有 "+i(ht(x.value)),1)):m("",!0)])])],32)):m("",!0),E.value.length>0?(o(),a("div",{key:4,ref_key:"noticeAnchor",ref:_t,class:"px-4 mt-4"},[s("div",Vs,[t[33]||(t[33]=s("div",{class:"flex items-center gap-2 mb-4"},[s("svg",{class:"w-5 h-5 text-primary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})]),s("span",{class:"font-medium text-gray-800"},"商户通知")],-1)),s("div",Es,[(o(!0),a(W,null,G(E.value,l=>(o(),a("div",{key:l.id,class:p(["bg-white rounded-lg p-3 shadow-sm",l.is_pinned?"border-l-4 border-red-500 bg-red-50":"border-l-4 border-orange-500 bg-orange-50"])},[s("div",zs,[s("span",Qs,i(l.title),1),l.is_pinned?(o(),a("span",Rs,"置顶")):m("",!0)]),s("div",Ps,i(l.content),1),s("div",Ys,i(C(V)(l.created_at)),1)],2))),128))])])],512)):m("",!0),nt.value?(o(),a("div",{key:5,style:ye({height:pe()})},null,4)):m("",!0),at.value?(o(),a("div",{key:6,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:b(ct,["self"])},[s("div",qs,[s("div",{class:"bg-primary text-white px-5 py-4 flex items-center justify-between"},[t[35]||(t[35]=s("h3",{class:"font-medium text-lg"},"选择预约时间",-1)),s("button",{onClick:ct,class:"text-white"},[...t[34]||(t[34]=[s("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),s("div",Os,[s("div",Xs,[s("button",{type:"button",onClick:t[6]||(t[6]=l=>f.value="time"),class:p([f.value==="time"?"bg-primary text-white":"bg-gray-100 text-gray-700","flex-1 py-2 px-4 rounded-lg font-medium transition-colors"])}," 按时间段 ",2),s("button",{type:"button",onClick:t[7]||(t[7]=l=>f.value="technician"),disabled:L.value.length===0,class:p([f.value==="technician"?"bg-primary text-white":"bg-gray-100 text-gray-700","flex-1 py-2 px-4 rounded-lg font-medium transition-colors disabled:opacity-50"])}," 选技师 ",10,Ws)]),f.value==="technician"?(o(),a("div",Gs,[t[36]||(t[36]=s("div",{class:"text-sm font-medium text-gray-700 mb-2"},"选择技师",-1)),rt.value?(o(),a("div",Js,"加载中...")):L.value.length===0?(o(),a("div",Ks,"暂无技师")):(o(),a("div",Zs,[(o(!0),a(W,null,G(L.value,l=>(o(),a("button",{key:l.id,type:"button",onClick:X=>T.value=l.id,class:p([T.value===l.id?"bg-primary text-white":"bg-white border-2 border-gray-200 text-gray-700 hover:border-primary","py-2 px-3 rounded-lg font-medium transition-all text-sm"])},i(l.name),11,tn))),128))]))])):m("",!0)]),s("div",en,[s("div",sn,[s("button",{onClick:t[8]||(t[8]=l=>Tt("today")),class:p([k.value===ut()?"bg-primary text-white":"bg-gray-100 text-gray-700","flex-1 py-2 px-4 rounded-lg font-medium transition-colors"])}," 今天 ",2),s("button",{onClick:t[9]||(t[9]=l=>Tt("tomorrow")),class:p([k.value===kt()?"bg-primary text-white":"bg-gray-100 text-gray-700","flex-1 py-2 px-4 rounded-lg font-medium transition-colors"])}," 明天 ",2)])]),s("div",nn,[ot.value?(o(),a("div",an," 加载中... ")):H.value.length===0?(o(),a("div",on," 今日无可用时间段 ")):(o(),a("div",rn,[(o(!0),a(W,null,G(H.value,l=>(o(),a("button",{key:l.time,onClick:X=>ee(l),disabled:!l.available,class:p([{"bg-primary text-white":h.value===l.time&&l.available,"bg-gray-100 text-gray-400 cursor-not-allowed":!l.available,"bg-white border-2 border-gray-200 text-gray-700 hover:border-primary":l.available&&h.value!==l.time},"py-3 px-4 rounded-lg font-medium transition-all"])},[s("div",null,i(se(l.time)),1),l.available?m("",!0):(o(),a("div",cn,"已被预约"))],10,ln))),128))]))]),s("div",un,[s("button",{onClick:ne,disabled:!h.value||D.value||f.value==="technician"&&!T.value,class:"w-full py-3 bg-primary text-white font-medium rounded-lg hover:bg-primary-dark disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},i(D.value?"预纤中...":"确认预约"),9,dn)])])])):m("",!0)])}}};export{xn as default};
