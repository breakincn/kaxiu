const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.DuRPLurf.js","assets/index.BYIGvkoh.js","assets/vendor.Da2sdW28.js","assets/index.CawrLTIk.css"])))=>i.map(i=>d[i]);
import{_ as j,a as A}from"./index.BYIGvkoh.js";import{e as v,s as S,x as U,f as i,g as t,t as f,n as m,l as k,w as $,i as w,v as _,u as D,o as d}from"./vendor.Da2sdW28.js";import{m as h,l as E}from"./index.DuRPLurf.js";const N={class:"min-h-screen bg-gray-50"},H={class:"bg-white px-4 py-3 flex items-center gap-3 border-b sticky top-0 z-10"},R={class:"font-medium text-gray-800"},L={key:0,class:"flex items-center justify-center py-12"},O={key:1,class:"px-4 py-6"},q={class:"bg-white rounded-xl shadow-sm p-6"},F={class:"text-center"},G={class:"text-2xl font-semibold text-gray-800 mb-6 no-underline",style:{"text-decoration":"none"}},J={key:0,class:"mt-4 px-4 py-3 bg-yellow-50 rounded-lg"},K={key:2,class:"px-4 py-6"},Q={class:"bg-white rounded-xl shadow-sm p-6"},W={key:0},X={class:"flex gap-2"},Y=["disabled"],Z={type:"submit",class:"w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 font-medium mt-6"},ee={key:0,class:"mt-4 px-4 py-3 bg-blue-50 rounded-lg"},te={class:"text-sm text-blue-600"},le={__name:"BindPhone",setup(ae){const C=D(),y=v(!0),a=v(""),p=v(!1),l=v(""),n=v(""),c=v(""),r=v(0);let b=null;const u=()=>E()==="staff",M=async()=>{y.value=!0;try{if(u()){const e=(await h.getCurrentTechnician()).data.data;e.phone&&(a.value=e.phone)}else{const e=(await h.getCurrentMerchant()).data.data;e.phone&&(a.value=e.phone)}}catch(o){console.error("获取商户信息失败:",o)}finally{y.value=!1}},B=()=>{C.back()},z=()=>{p.value=!0,l.value="",n.value="",c.value=""},I=()=>{p.value=!1,l.value="",n.value="",c.value="",r.value>0&&(clearInterval(b),r.value=0)},P=async()=>{var o,e,s;if(!l.value){alert("请输入手机号");return}if(!/^1[3-9]\d{9}$/.test(l.value)){alert("请输入正确的手机号");return}try{const g=await A(async()=>{const{default:x}=await import("./index.DuRPLurf.js").then(T=>T.w);return{default:x}},__vite__mapDeps([0,1,2,3])).then(({default:x})=>x.post("/sms/send",{phone:l.value,purpose:u()?"technician_bind_phone":"merchant_bind_phone"}));(o=g.data.data)!=null&&o.debug_code?alert(`验证码已发送（开发环境）：${g.data.data.debug_code}`):alert("验证码已发送，请查收短信"),r.value=60,b=setInterval(()=>{r.value--,r.value<=0&&clearInterval(b)},1e3)}catch(g){alert(((s=(e=g.response)==null?void 0:e.data)==null?void 0:s.error)||"发送验证码失败")}},V=async()=>{var o,e;if(!l.value){alert("请输入手机号");return}if(!/^1[3-9]\d{9}$/.test(l.value)){alert("请输入正确的手机号");return}if(!n.value){alert("请输入验证码");return}if(!u()&&a.value&&!c.value){alert("请输入商户密码");return}try{u()?await h.bindTechnicianPhone(l.value,n.value):await h.bindPhone(l.value,n.value,c.value),alert(a.value?"更换成功！":"绑定成功！"),a.value=l.value,p.value=!1,l.value="",n.value="",c.value="",u()||localStorage.setItem("merchantPhone",l.value)}catch(s){alert(((e=(o=s.response)==null?void 0:o.data)==null?void 0:e.error)||(a.value?"更换失败":"绑定失败"))}};return S(()=>{M()}),U(()=>{b&&clearInterval(b)}),(o,e)=>(d(),i("div",N,[t("header",H,[t("button",{onClick:B,class:"p-1"},[...e[3]||(e[3]=[t("svg",{class:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),t("span",R,f(a.value?"更换手机号":"绑定手机号"),1)]),y.value?(d(),i("div",L,[...e[4]||(e[4]=[t("div",{class:"text-gray-400"},"加载中...",-1)])])):a.value&&!p.value?(d(),i("div",O,[t("div",q,[t("div",F,[e[5]||(e[5]=t("div",{class:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4"},[t("svg",{class:"w-8 h-8 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e[6]||(e[6]=t("h3",{class:"text-lg font-medium text-gray-800 mb-2"},"已绑定手机号",-1)),t("p",G,f(a.value),1),t("button",{onClick:z,class:"w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 font-medium"}," 更换手机号 ")])]),u()?m("",!0):(d(),i("div",J,[...e[7]||(e[7]=[t("p",{class:"text-sm text-yellow-600"},[t("svg",{class:"w-4 h-4 inline-block mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),k(" 更换手机号需要验证商户密码和新手机号验证码，请确保新手机号可以正常接收验证码 ")],-1)])]))])):(d(),i("div",K,[t("div",Q,[t("form",{onSubmit:$(V,["prevent"]),class:"space-y-4"},[a.value&&!u()?(d(),i("div",W,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"商户密码",-1)),w(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>c.value=s),type:"password",placeholder:"请输入商户密码",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[_,c.value]])])):m("",!0),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"手机号",-1)),w(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>l.value=s),type:"tel",placeholder:"请输入手机号",maxlength:"11",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[_,l.value]])]),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"验证码",-1)),t("div",X,[w(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>n.value=s),type:"text",placeholder:"请输入验证码",maxlength:"6",class:"flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[_,n.value]]),t("button",{type:"button",onClick:P,disabled:r.value>0,class:"px-4 py-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:bg-gray-300 disabled:cursor-not-allowed whitespace-nowrap"},f(r.value>0?`${r.value}秒后重试`:"发送验证码"),9,Y)])]),t("button",Z,f(a.value?"确认更换":"确认绑定"),1),p.value?(d(),i("button",{key:1,type:"button",onClick:I,class:"w-full bg-gray-200 text-gray-700 py-3 rounded-lg hover:bg-gray-300 font-medium mt-3"}," 取消 ")):m("",!0)],32)]),p.value?m("",!0):(d(),i("div",ee,[t("p",te,[e[11]||(e[11]=t("svg",{class:"w-4 h-4 inline-block mr-1",fill:"currentColor",viewBox:"0 0 20 20"},[t("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)),k(" "+f(u()?"绑定手机号后，将用于该账号的联系方式":"绑定手机号后，可以使用手机号登录商户管理后台"),1)])]))]))]))}},re=j(le,[["__scopeId","data-v-c3e31ec9"]]);export{re as default};
