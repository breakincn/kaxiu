import{e as c,s as Z,f as i,g as e,n as x,F as B,z as $,w as A,t as u,i as m,v,l as D,L as I,u as ee,o as n,y as F}from"./vendor.Da2sdW28.js";import{v as p}from"./index.DuRPLurf.js";import"./index.BYIGvkoh.js";const te={class:"min-h-screen bg-gray-50"},se={class:"px-4 py-4 space-y-4"},oe={class:"bg-white rounded-xl shadow-sm p-4"},le={key:0,class:"text-center text-gray-400 py-10"},ae={key:1},ie={key:0,class:"text-center text-gray-400 py-10"},ne={key:1,class:"mt-4 space-y-3"},re={class:"flex items-start justify-between gap-3"},de={class:"flex items-center gap-2"},ue={class:"text-gray-800 font-medium"},ce={key:0,class:"px-2 py-0.5 rounded text-xs bg-blue-50 text-blue-600"},me={class:"text-gray-500 text-sm mt-1"},pe={key:0,class:"text-gray-400 text-sm mt-1"},ye={class:"text-gray-400 text-xs"},ve={class:"mt-3 flex gap-2"},xe=["onClick"],be=["onClick"],fe=["onClick"],ge=["onClick"],_e={class:"bg-white rounded-xl shadow-sm p-4"},ke={key:0,class:"text-center text-gray-400 py-10"},we={key:1},he={key:0,class:"text-center text-gray-400 py-10"},Ce={key:1,class:"mt-4 space-y-3"},je={class:"flex items-start justify-between gap-3"},Re={class:"text-gray-800 font-medium"},Pe={class:"text-gray-500 text-sm mt-1"},Me={key:0,class:"text-gray-400 text-sm mt-1"},Ve={class:"text-gray-400 text-xs"},Ue={class:"mt-3 flex gap-2"},Se=["onClick"],ze=["onClick"],Be={class:"bg-white rounded-2xl w-full max-w-md overflow-hidden"},$e={class:"px-5 py-4 border-b flex items-center justify-between"},Ae={class:"font-medium text-gray-800"},De={class:"px-5 py-5"},Ie={key:0,class:"mb-4"},Le={class:"mb-4"},Te={class:"mb-4"},Fe={class:"mb-4"},Ee={class:"mb-5 flex items-center gap-4"},Ne={class:"flex items-center gap-2 text-sm text-gray-700"},qe={class:"flex items-center gap-2 text-sm text-gray-700"},Ge=["disabled"],He={class:"bg-white rounded-2xl w-full max-w-md overflow-hidden"},Je={class:"px-5 py-4 border-b flex items-center justify-between"},Ke={class:"font-medium text-gray-800"},Oe={class:"px-5 py-5"},Qe={key:0,class:"mb-4"},We={class:"mb-4"},Xe={class:"mb-4"},Ye={class:"mb-4"},Ze={class:"mb-5"},et=["disabled"],tt={class:"bg-white rounded-2xl w-full max-w-2xl overflow-hidden"},st={class:"px-5 py-4 border-b flex items-center justify-between"},ot={class:"font-medium text-gray-800"},lt={class:"px-5 py-5"},at={key:0,class:"text-center text-gray-400 py-10"},it={key:1},nt={key:0,class:"text-center text-gray-400 py-10"},rt={key:1,class:"max-h-[60vh] overflow-y-auto border border-gray-100 rounded-xl"},dt={class:"text-gray-800 text-sm font-medium"},ut={class:"text-gray-500 text-xs"},ct={class:"flex items-center gap-2 text-sm text-gray-700"},mt=["onUpdate:modelValue"],pt=["disabled"],ft={__name:"Dashboard",setup(yt){const L=ee(),w=c([]),h=c([]),C=c(!1),j=c(!1),r=c(!1),g=c(!1),l=c({id:0,key:"",name:"",description:"",sort:0,is_active:!0,allow_permission_adjust:!1}),_=c(!1),a=c({id:0,key:"",name:"",group:"",description:"",sort:0}),R=c(!1),f=c(null),b=c([]),P=c(!1),T=()=>{localStorage.removeItem("platformAdminToken"),L.replace("/platform-admin/login")},E=()=>localStorage.getItem("platformAdminToken")?!0:(L.replace("/platform-admin/login"),!1),k=async()=>{var o;C.value=!0;try{const t=await p.listServiceRoles();w.value=((o=t.data)==null?void 0:o.data)||[]}finally{C.value=!1}},M=async()=>{var o;j.value=!0;try{const t=await p.listPermissions();h.value=((o=t.data)==null?void 0:o.data)||[]}finally{j.value=!1}},N=()=>{l.value={id:0,key:"",name:"",description:"",sort:0,is_active:!0,allow_permission_adjust:!1},g.value=!0},q=o=>{l.value={id:o.id,key:o.key,name:o.name,description:o.description||"",sort:o.sort||0,is_active:!!o.is_active,allow_permission_adjust:!!o.allow_permission_adjust},g.value=!0},V=()=>{g.value=!1},G=async()=>{var o,t;if(!r.value){if(!l.value.name){alert("请输入 name");return}if(!l.value.id&&!l.value.key){alert("请输入 key");return}r.value=!0;try{l.value.id?await p.updateServiceRole(l.value.id,{name:l.value.name,description:l.value.description,sort:l.value.sort,is_active:l.value.is_active,allow_permission_adjust:l.value.allow_permission_adjust}):await p.createServiceRole({key:l.value.key,name:l.value.name,description:l.value.description,sort:l.value.sort,is_active:l.value.is_active,allow_permission_adjust:l.value.allow_permission_adjust}),V(),await k()}catch(d){alert(((t=(o=d.response)==null?void 0:o.data)==null?void 0:t.error)||"保存失败")}finally{r.value=!1}}},H=async o=>{var t,d;if(!r.value){r.value=!0;try{await p.updateServiceRole(o.id,{is_active:!o.is_active}),await k()}catch(s){alert(((d=(t=s.response)==null?void 0:t.data)==null?void 0:d.error)||"操作失败")}finally{r.value=!1}}},J=async o=>{var t,d;if(confirm("确定要删除该角色吗？")&&!r.value){r.value=!0;try{await p.deleteServiceRole(o.id),await k()}catch(s){alert(((d=(t=s.response)==null?void 0:t.data)==null?void 0:d.error)||"删除失败")}finally{r.value=!1}}},K=()=>{a.value={id:0,key:"",name:"",group:"",description:"",sort:0},_.value=!0},O=o=>{a.value={id:o.id,key:o.key,name:o.name,group:o.group||"",description:o.description||"",sort:o.sort||0},_.value=!0},U=()=>{_.value=!1},Q=async()=>{var o,t;if(!r.value){if(!a.value.name){alert("请输入 name");return}if(!a.value.id&&!a.value.key){alert("请输入 key");return}r.value=!0;try{a.value.id?await p.updatePermission(a.value.id,{name:a.value.name,group:a.value.group,description:a.value.description,sort:a.value.sort}):await p.createPermission({key:a.value.key,name:a.value.name,group:a.value.group,description:a.value.description,sort:a.value.sort}),U(),await M()}catch(d){alert(((t=(o=d.response)==null?void 0:o.data)==null?void 0:t.error)||"保存失败")}finally{r.value=!1}}},W=async o=>{var t,d;if(confirm("确定要删除该权限吗？")&&!r.value){r.value=!0;try{await p.deletePermission(o.id),await M()}catch(s){alert(((d=(t=s.response)==null?void 0:t.data)==null?void 0:d.error)||"删除失败")}finally{r.value=!1}}},X=async o=>{var t,d,s,y;R.value=!0,f.value=o,b.value=[],P.value=!0;try{const z=await p.getRolePermissions(o.id);b.value=((d=(t=z.data)==null?void 0:t.data)==null?void 0:d.items)||[]}catch(z){alert(((y=(s=z.response)==null?void 0:s.data)==null?void 0:y.error)||"加载失败")}finally{P.value=!1}},S=()=>{R.value=!1,f.value=null,b.value=[]},Y=async()=>{var o,t;if(f.value&&!r.value){r.value=!0;try{const d=b.value.map(s=>({permission_key:s.permission.key,allowed:!!s.allowed}));await p.setRolePermissions(f.value.id,{items:d}),S()}catch(d){alert(((t=(o=d.response)==null?void 0:o.data)==null?void 0:t.error)||"保存失败")}finally{r.value=!1}}};return Z(async()=>{var o,t;if(E())try{await Promise.all([k(),M()])}catch(d){const s=((t=(o=d.response)==null?void 0:o.data)==null?void 0:t.error)||"";if(s==="无权限"||s==="平台管理员未配置"){T();return}}}),(o,t)=>{var d;return n(),i("div",te,[e("header",{class:"bg-white px-4 py-3 flex items-center gap-3 border-b sticky top-0 z-10"},[t[11]||(t[11]=e("span",{class:"font-medium text-gray-800"},"平台后台",-1)),t[12]||(t[12]=e("div",{class:"flex-1"},null,-1)),e("button",{type:"button",class:"px-3 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium",onClick:T}," 退出 ")]),e("div",se,[e("div",oe,[e("div",{class:"flex items-center justify-between"},[t[13]||(t[13]=e("div",{class:"text-gray-800 font-medium"},"客服类型（ServiceRole）",-1)),e("button",{type:"button",class:"px-3 py-2 bg-primary text-white rounded-lg text-sm font-medium",onClick:N}," 新增 ")]),C.value?(n(),i("div",le,"加载中...")):(n(),i("div",ae,[w.value.length===0?(n(),i("div",ie,"暂无角色")):(n(),i("div",ne,[(n(!0),i(B,null,$(w.value,s=>(n(),i("div",{key:s.id,class:"border border-gray-100 rounded-xl p-4"},[e("div",re,[e("div",null,[e("div",de,[e("div",ue,u(s.name),1),e("span",{class:F(["px-2 py-0.5 rounded text-xs",s.is_active?"bg-green-50 text-green-600":"bg-gray-100 text-gray-500"])},u(s.is_active?"启用":"禁用"),3),s.allow_permission_adjust?(n(),i("span",ce,"可微调")):x("",!0)]),e("div",me,"key："+u(s.key)+"　sort："+u(s.sort),1),s.description?(n(),i("div",pe,u(s.description),1)):x("",!0)]),e("div",ye,"ID: "+u(s.id),1)]),e("div",ve,[e("button",{type:"button",class:"px-3 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium",onClick:y=>q(s)},"编辑",8,xe),e("button",{type:"button",class:F(["px-3 py-2 rounded-lg text-sm font-medium",s.is_active?"bg-orange-50 text-orange-600":"bg-green-50 text-green-600"]),onClick:y=>H(s)},u(s.is_active?"禁用":"启用"),11,be),e("button",{type:"button",class:"px-3 py-2 bg-blue-50 text-blue-600 rounded-lg text-sm font-medium",onClick:y=>X(s)}," 配置默认权限 ",8,fe),t[14]||(t[14]=e("div",{class:"flex-1"},null,-1)),e("button",{type:"button",class:"px-3 py-2 bg-red-50 text-red-600 rounded-lg text-sm font-medium",onClick:y=>J(s)}," 删除 ",8,ge)])]))),128))]))]))]),e("div",_e,[e("div",{class:"flex items-center justify-between"},[t[15]||(t[15]=e("div",{class:"text-gray-800 font-medium"},"权限枚举（Permission）",-1)),e("button",{type:"button",class:"px-3 py-2 bg-primary text-white rounded-lg text-sm font-medium",onClick:K}," 新增 ")]),j.value?(n(),i("div",ke,"加载中...")):(n(),i("div",we,[h.value.length===0?(n(),i("div",he,"暂无权限")):(n(),i("div",Ce,[(n(!0),i(B,null,$(h.value,s=>(n(),i("div",{key:s.id,class:"border border-gray-100 rounded-xl p-4"},[e("div",je,[e("div",null,[e("div",Re,u(s.name),1),e("div",Pe,"key："+u(s.key)+"　group："+u(s.group||"-")+"　sort："+u(s.sort),1),s.description?(n(),i("div",Me,u(s.description),1)):x("",!0)]),e("div",Ve,"ID: "+u(s.id),1)]),e("div",Ue,[e("button",{type:"button",class:"px-3 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium",onClick:y=>O(s)},"编辑",8,Se),t[16]||(t[16]=e("div",{class:"flex-1"},null,-1)),e("button",{type:"button",class:"px-3 py-2 bg-red-50 text-red-600 rounded-lg text-sm font-medium",onClick:y=>W(s)},"删除",8,ze)])]))),128))]))]))])]),g.value?(n(),i("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center px-4 z-50",onClick:A(V,["self"])},[e("div",Be,[e("div",$e,[e("div",Ae,u(l.value.id?"编辑角色":"新增角色"),1),e("button",{type:"button",class:"text-gray-400",onClick:V},[...t[17]||(t[17]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",De,[l.value.id?x("",!0):(n(),i("div",Ie,[t[18]||(t[18]=e("label",{class:"block text-gray-700 text-sm font-medium mb-2"},"key",-1)),m(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>l.value.key=s),type:"text",placeholder:"如 technician",class:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:border-primary"},null,512),[[v,l.value.key]])])),e("div",Le,[t[19]||(t[19]=e("label",{class:"block text-gray-700 text-sm font-medium mb-2"},"name",-1)),m(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>l.value.name=s),type:"text",placeholder:"如 技师",class:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:border-primary"},null,512),[[v,l.value.name]])]),e("div",Te,[t[20]||(t[20]=e("label",{class:"block text-gray-700 text-sm font-medium mb-2"},"description",-1)),m(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>l.value.description=s),type:"text",placeholder:"描述",class:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:border-primary"},null,512),[[v,l.value.description]])]),e("div",Fe,[t[21]||(t[21]=e("label",{class:"block text-gray-700 text-sm font-medium mb-2"},"sort",-1)),m(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>l.value.sort=s),type:"number",class:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:border-primary"},null,512),[[v,l.value.sort,void 0,{number:!0}]])]),e("div",Ee,[e("label",Ne,[m(e("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=s=>l.value.is_active=s)},null,512),[[I,l.value.is_active]]),t[22]||(t[22]=D("启用",-1))]),e("label",qe,[m(e("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=s=>l.value.allow_permission_adjust=s)},null,512),[[I,l.value.allow_permission_adjust]]),t[23]||(t[23]=D("允许商户微调",-1))])]),e("button",{type:"button",class:"w-full py-3 bg-primary text-white rounded-lg font-medium disabled:opacity-50",disabled:r.value,onClick:G},u(r.value?"保存中...":"保存"),9,Ge)])])])):x("",!0),_.value?(n(),i("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center px-4 z-50",onClick:A(U,["self"])},[e("div",He,[e("div",Je,[e("div",Ke,u(a.value.id?"编辑权限":"新增权限"),1),e("button",{type:"button",class:"text-gray-400",onClick:U},[...t[24]||(t[24]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Oe,[a.value.id?x("",!0):(n(),i("div",Qe,[t[25]||(t[25]=e("label",{class:"block text-gray-700 text-sm font-medium mb-2"},"key",-1)),m(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>a.value.key=s),type:"text",placeholder:"如 merchant.card.verify",class:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:border-primary"},null,512),[[v,a.value.key]])])),e("div",We,[t[26]||(t[26]=e("label",{class:"block text-gray-700 text-sm font-medium mb-2"},"name",-1)),m(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>a.value.name=s),type:"text",placeholder:"如 核销",class:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:border-primary"},null,512),[[v,a.value.name]])]),e("div",Xe,[t[27]||(t[27]=e("label",{class:"block text-gray-700 text-sm font-medium mb-2"},"group",-1)),m(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>a.value.group=s),type:"text",placeholder:"如 卡片",class:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:border-primary"},null,512),[[v,a.value.group]])]),e("div",Ye,[t[28]||(t[28]=e("label",{class:"block text-gray-700 text-sm font-medium mb-2"},"description",-1)),m(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>a.value.description=s),type:"text",placeholder:"描述",class:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:border-primary"},null,512),[[v,a.value.description]])]),e("div",Ze,[t[29]||(t[29]=e("label",{class:"block text-gray-700 text-sm font-medium mb-2"},"sort",-1)),m(e("input",{"onUpdate:modelValue":t[10]||(t[10]=s=>a.value.sort=s),type:"number",class:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:border-primary"},null,512),[[v,a.value.sort,void 0,{number:!0}]])]),e("button",{type:"button",class:"w-full py-3 bg-primary text-white rounded-lg font-medium disabled:opacity-50",disabled:r.value,onClick:Q},u(r.value?"保存中...":"保存"),9,et)])])])):x("",!0),R.value?(n(),i("div",{key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center px-4 z-50",onClick:A(S,["self"])},[e("div",tt,[e("div",st,[e("div",ot,"配置默认权限："+u((d=f.value)==null?void 0:d.name),1),e("button",{type:"button",class:"text-gray-400",onClick:S},[...t[30]||(t[30]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",lt,[P.value?(n(),i("div",at,"加载中...")):(n(),i("div",it,[b.value.length===0?(n(),i("div",nt,"暂无权限")):(n(),i("div",rt,[(n(!0),i(B,null,$(b.value,s=>(n(),i("div",{key:s.permission.id,class:"flex items-center justify-between px-4 py-3 border-b border-gray-100"},[e("div",null,[e("div",dt,u(s.permission.name),1),e("div",ut,u(s.permission.key),1)]),e("label",ct,[m(e("input",{type:"checkbox","onUpdate:modelValue":y=>s.allowed=y},null,8,mt),[[I,s.allowed]]),t[31]||(t[31]=D("允许 ",-1))])]))),128))])),e("button",{type:"button",class:"mt-4 w-full py-3 bg-primary text-white rounded-lg font-medium disabled:opacity-50",disabled:r.value,onClick:Y},u(r.value?"保存中...":"保存"),9,pt)]))])])])):x("",!0)])}}};export{ft as default};
