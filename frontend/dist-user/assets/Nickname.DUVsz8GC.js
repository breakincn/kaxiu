import{e as u,s as g,f,g as t,i as k,v as b,t as v,u as h,E as d,o as x}from"./vendor.Da2sdW28.js";const y={class:"min-h-screen bg-gray-50"},w={class:"px-4 py-6"},_={class:"bg-white rounded-xl shadow-sm p-6"},B={class:"mb-6"},S=["disabled"],z={__name:"Nickname",setup(I){const a=h(),n=u(""),l=u(!1),c=()=>{a.back()},p=async()=>{var o;try{const e=localStorage.getItem("userToken");if(!e){a.push("/login");return}const s=await d.get("/api/me",{headers:{Authorization:`Bearer ${e}`}});s.data.data&&s.data.data.nickname&&(n.value=s.data.data.nickname)}catch(e){console.error("获取用户信息失败:",e),((o=e.response)==null?void 0:o.status)===401&&(localStorage.removeItem("userToken"),a.push("/login"))}},m=async()=>{var e,s,i;const o=n.value.trim();if(!o){alert("请输入昵称");return}l.value=!0;try{const r=localStorage.getItem("userToken");if(!r){alert("请先登录"),a.push("/login");return}(await d.put("/api/user/nickname",{nickname:o},{headers:{Authorization:`Bearer ${r}`}})).data.data&&(localStorage.setItem("userName",o),alert("昵称保存成功"),a.back())}catch(r){console.error("保存昵称失败:",r),((e=r.response)==null?void 0:e.status)===401?(alert("登录已过期，请重新登录"),localStorage.removeItem("userToken"),a.push("/login")):alert(((i=(s=r.response)==null?void 0:s.data)==null?void 0:i.error)||"保存昵称失败，请稍后重试")}finally{l.value=!1}};return g(()=>{p()}),(o,e)=>(x(),f("div",y,[t("header",{class:"bg-white px-4 py-3 flex items-center gap-3 border-b sticky top-0 z-10"},[t("button",{onClick:c,class:"p-1"},[...e[1]||(e[1]=[t("svg",{class:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),e[2]||(e[2]=t("span",{class:"font-medium text-gray-800"},"我的昵称",-1))]),t("div",w,[t("div",_,[t("div",B,[e[3]||(e[3]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," 昵称 ",-1)),k(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>n.value=s),type:"text",placeholder:"请输入昵称",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent",maxlength:"50"},null,512),[[b,n.value]]),e[4]||(e[4]=t("p",{class:"mt-2 text-sm text-gray-500"}," 昵称可以是任意字符，不要求唯一 ",-1))]),t("button",{onClick:m,disabled:l.value||!n.value.trim(),class:"w-full bg-purple-500 text-white py-3 rounded-lg font-medium hover:bg-purple-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"},v(l.value?"保存中...":"保存"),9,S)])])]))}};export{z as default};
